# Story 1.3: Email/Password Log-in & Session Management

## Status
TODO

## Story
**As a** returning user,
**I want** to log in with my email and password and remain logged in,
**so that** I can access my saved data.

## Acceptance Criteria
1. A log-in screen is created with a "Forgot Password" link
2. "Log In" authenticates with Firebase
3. The user is navigated to the dashboard on success
4. The user's session is persisted
5. Clear error messages are shown on failure
6. "Forgot Password" triggers the reset flow

## Tasks / Subtasks
- [ ] Task 1: Create Log-in Screen UI (AC: 1)
  - [ ] Create LoginScreen component in src/screens/auth/
  - [ ] Implement form with email and password fields using React Native Paper
  - [ ] Add "Forgot Password" link/button
  - [ ] Add "Sign Up" navigation link for new users
  - [ ] Create loading states and disable form during submission
  - [ ] Style according to dark theme requirements
- [ ] Task 2: Implement Login Authentication (AC: 2, 3, 5)
  - [ ] Add signInWithEmail function to authService.ts
  - [ ] Implement proper error handling and user-friendly messages
  - [ ] Handle various Firebase auth error codes
  - [ ] Navigate to dashboard on successful login
- [ ] Task 3: Implement Session Persistence (AC: 4)
  - [ ] Configure Firebase Auth persistence settings
  - [ ] Implement auth state listener in AuthContext
  - [ ] Handle auto-login on app launch if session exists
  - [ ] Store auth state in secure storage for offline access
  - [ ] Implement session timeout handling if required
- [ ] Task 4: Implement Password Reset Flow (AC: 6)
  - [ ] Create ForgotPasswordScreen component
  - [ ] Implement sendPasswordResetEmail in authService
  - [ ] Add navigation flow from login to forgot password
  - [ ] Show success/error messages for reset email
  - [ ] Add back navigation to login screen
- [ ] Task 5: Enhance Auth Context (AC: 3, 4)
  - [ ] Add signOut functionality to AuthContext
  - [ ] Implement loading states during auth checks
  - [ ] Add user profile fetching on login
  - [ ] Handle auth state changes properly
  - [ ] Implement error boundaries for auth failures
- [ ] Task 6: Testing (Testing Standards)
  - [ ] Write unit tests for login service functions
  - [ ] Write unit tests for password reset flow
  - [ ] Test session persistence across app restarts
  - [ ] Test error scenarios (wrong password, non-existent user)
  - [ ] Test offline login with cached credentials

## Dev Notes
- Ensure session persists according to NFR5 requirements
- Handle offline scenarios gracefully
- Map Firebase error codes to user-friendly messages
- Consider implementing biometric authentication in future
- Follow security best practices for credential storage

## Testing Strategy
- Unit test auth service login methods
- Test various error scenarios and edge cases
- Verify session persistence across app lifecycle
- Test password reset email delivery
- Integration test the complete login flow
- Test offline authentication scenarios

## Dev Agent Record

### Agent Model Used
*To be filled when development starts*

### Debug Log References
*To be updated as implementation progresses*

### Completion Notes List
*To be updated as tasks are completed*

### File List
*To be updated with created/modified files*

## QA Results
*QA testing results will be documented here*

## Change Log
| Date | Changes | Author |
| :--- | :--- | :--- |
| [Current Date] | Story created | SM Agent |